!function(t,e){"function"==typeof define?define("/static/common/mod/suggestion/suggestion.js",function(t){return e(t("common:jquery"),t("common:util"))}):(t.FeatherUi=t.FeatherUi||{},t.FeatherUi.Suggestion=e(t.jQuery||t.$,t.FeatherUi.Util))}(window,function(t,e){function i(e){this.options=t.extend({dom:null,width:!1,max:10,caching:!0,url:null,data:null,delay:300,empty2close:!0,emptyNoCache:!1,kw:"kw",requestParams:{},resultField:"",match:null,format:null,build:function(){},switchCallback:function(){},callback:function(){},cancel:function(){}},e||{}),this.init()}return i.prototype={init:function(){var e=this,i=e.options;e.dom=t(i.dom).attr("autocomplete","off"),e.parent=e.dom.parent(),!/fixed|absolute/.test(e.parent.css("position"))&&e.parent.css("position","relative"),e.suggest=t('<ul class="ui-suggestion"><li class="ui-suggestion-header"></li><li class="ui-suggestion-footer"></li></ul>').appendTo(e.parent),e.xhr=null,e.tid=null,e.index=null,e.setData(i.data),e.initEvent()},initEvent:function(){var e=this,n=e.options,s=!1;e.dom.on("keyup paste cut",function(t){if(13==t.keyCode){var n=e.suggest.find(".ui-suggestion-active");return n.length&&e.setKw(n.attr("data-suggestion-kw"),n,!0),e.close()}!i.isUDEvent(t)&&e.match()}).focus(function(){e.match()}).keydown(function(t){i.isUDEvent(t)&&e.switchKw(t)}).blur(function(){s||(e.close(),n.cancel&&n.cancel.call(this))}),e.suggest.delegate(".ui-suggestion-item","click",function(){e.setKw(t(this).attr("data-suggestion-kw"),t(this),!0),e.close()}).hover(function(){s=!0},function(){s=!1}),e.suggest.find(".ui-suggestion-header, .ui-suggestion-footer").click(function(){e.dom.focus()})},setKw:function(t,e,i){var n=this;n.dom.val(t),i&&n.options.callback&&n.options.callback.call(n,t,e)},switchKw:function(t){var e=this;if(e.items){var i=t.keyCode,n=e.items.length-1,s=null==e.index?-1:e.index;38==i?s--:s++,0>s?s=n:s>n&&(s=0),e.index=s,e.items.removeClass("ui-suggestion-active");var o=e.items.eq(s).addClass("ui-suggestion-active"),a=o.attr("data-suggestion-kw");e.setKw(a),e.options.switchCallback&&e.options.switchCallback.call(e,a,o),t.preventDefault()}},setData:function(t){this.data=t},setTitle:function(t){this.setHeader(t)},setHeader:function(t){var e=this.suggest.find(".ui-suggestion-header");t?e.html(t).show():e.hide()},setFooter:function(t){var e=this.suggest.find(".ui-suggestion-footer");t?e.html(t).show():e.hide()},setRequestParams:function(t){this.options.requestParams=t},match:function(){var n=this,s=n.options;n.cancelMatch(),n.tid=setTimeout(function(){var o=n.dom.val();if(!t.trim(o)&&s.empty2close)return void n.close();var a=n.data,u=!s.caching||!t.trim(o)&&s.emptyNoCache?!1:i.cache[o];if(a&&(a=n._match.call(n,a,o)).length)n.build(a,o);else if(u)n.build(u,o);else if(s.url){var c=t.extend({},s.requestParams);c[s.kw]=o,n.xhr=t.getJSON(s.url,c,function(t){s.resultField&&(t=e.object.get(t,s.resultField)||[]),t=i.cache[o]=n._match.call(n,t,o),n.build(t,o)})}},s.delay)},cancelMatch:function(){var t=this;t.xhr&&t.xhr.abort(),t.tid&&clearTimeout(t.tid)},_match:function(t,e){var i=this,n=i.options;return n.match&&(t=n.match.call(i,t,e)),t.slice(0,n.max)},build:function(e,i){var n=this,s=n.options;if(n.index=null,e.length){var o="";t.each(e,function(t,e){o+='<li class="ui-suggestion-item" data-suggestion-index="'+t+'" data-suggestion-kw="'+e+'">'+n.format(e,i)+"</li>"}),n.items=t(o),n.suggest.find(".ui-suggestion-item").remove().end().find(".ui-suggestion-header").after(n.items),n.open(),s.build&&s.build.call(n)}else n.suggest.empty(),n.items=null,n.close()},open:function(){var t=this;if(t.items){var e=t.dom,i=e.position();t.suggest.show().css({left:i.left,top:i.top+e.outerHeight(),width:t.options.width||e.outerWidth()-2})}},close:function(){var t=this;t.suggest.hide()},format:function(t,e){var i=this,n=i.options;return n.format?n.format.call(i,t,e):t}},i.cache={},i.isUDEvent=function(t){return 38==t.keyCode||40==t.keyCode},i});