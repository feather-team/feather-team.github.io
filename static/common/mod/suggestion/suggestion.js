define("/static/common/mod/suggestion/suggestion.js",function(t,i,e){function n(t){this.options=s.extend({dom:null,width:!1,max:10,url:null,data:null,delay:300,kw:"kw",requestParams:{},resultField:"",callback:function(){},match:null,format:null},t||{}),this.init()}var s=t("common:jquery"),o=t("common:util");n.prototype={init:function(){var t=this,i=t.options;t.dom=s(i.dom).attr("autocomplete","off"),t.parent=t.dom.parent(),!/fixed|absolute/.test(t.parent.css("position"))&&t.parent.css("position","relative"),t.suggest=s('<ul class="ui-suggestion">').appendTo(t.parent),t.xhr=null,t.tid=null,t.index=null,t.setData(i.data),t.initEvent()},initEvent:function(){{var t=this;t.options}t.dom.on("keyup paste cut",function(i){!n.isUDEvent(i)&&t.match()}).focus(function(){t.match()}).keydown(function(i){n.isUDEvent(i)&&t.switchKw(i)}).blur(function(){setTimeout(function(){t.close()},100)}),t.suggest.delegate(".ui-suggestion-item","click",function(){t.setKw(s(this).attr("data-suggestion-kw"))})},setKw:function(t){this.dom.val(t)},switchKw:function(t){var i=this;if(i.items){var e=t.keyCode,n=i.items.length-1,s=null==i.index?-1:i.index;38==e?s--:s++,0>s?s=n:s>n&&(s=0),i.index=s,i.items.removeClass("ui-suggestion-active");var o=i.items.eq(s).addClass("ui-suggestion-active");i.dom.val(o.attr("data-suggestion-kw")),t.preventDefault()}},setData:function(t){this.data=t},match:function(){var t=this,i=t.options;t.cancelMatch(),t.tid=setTimeout(function(){var e=t.dom.val();if(e){var a=t.data,u=n.cache[e];if(a&&(a=t._match.call(t,a,e)).length)t.build(a,e);else if(u)t.build(u,e);else if(i.url){var l=s.extend({},i.requestParams);l[i.kw]=e,t.xhr=s.getJSON(i.url,l,function(s){i.resultField&&(s=o.object.get(s,i.resultField)||[]),n.cache[e]=s,t.build(t._match.call(t,s,e),e)})}}},i.delay)},cancelMatch:function(){var t=this;t.xhr&&t.xhr.abort(),t.tid&&clearTimeout(t.tid)},_match:function(t,i){var e,n=this,o=n.options;return o.match?e=o.match.call(n,t,i):(e=[],s.each(t,function(t,n){0==String(n).indexOf(i)&&e.push(n)})),e.slice(0,o.max)},build:function(t,i){{var e=this;e.options}if(e.index=null,t.length){var n="";s.each(t,function(t,s){n+='<li class="ui-suggestion-item" data-suggestion-index="'+t+'" data-suggestion-kw="'+s+'"><a href="javascript:;">'+e.format(s,i)+"</a></li>"}),e.suggest.html(n),e.items=e.suggest.find(".ui-suggestion-item"),e.open()}else e.suggest.empty(),e.items=null,e.close()},open:function(){var t=this;if(t.items){var i=t.dom,e=i.position();t.suggest.show().css({left:e.left,top:e.top+i.outerHeight(),width:t.options.width||i.outerWidth()-2})}},close:function(){var t=this;t.suggest.hide()},format:function(t,i){var e=this,n=e.options;return n.format?n.format.call(e,t,i):t}},n.cache={},n.isUDEvent=function(t){return 38==t.keyCode||40==t.keyCode},e.exports=n});